<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.3/JsBarcode.all.min.js"></script>

    <style>
        body{
           
            background-repeat: no-repeat;
          
          background-size: 100% 100%;
          background-image: url(../img/Grocery\ Discount\ Ticket\ .jpg);

          background-attachment: fixed;
          height: 100%;
        }
    

        #barcode {

            width: 200px;
           margin-top: 300px;
           margin-left: 100px;
           display: flex;
           justify-content: start;
        }

        #btn {
            padding: 12px 40px;
            background-color: rgb(2, 103, 66);
            color: #fff;
            font-size: 17px;
            border: none;
            border-radius: 3px;
        }
    </style>
</head>
<div class="block">
    <div class="content">
        <div id="code">
         
            <svg id="barcode"></svg>    
     
        </div>
        

    </div>

    
</div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        function generateRandomNumber() {
            const randomNum = Math.floor(100000000000 + Math.random() * 900000000000);
            return randomNum.toString();
        }

        function generateBarcode() {
            const randomNumber = generateRandomNumber();
            JsBarcode("#barcode", randomNumber);
            return randomNumber;
        }

        // Generate a barcode when the page loads
        let currentBarcode = generateBarcode();
    })
        // Handle the button click event
        async function fetchPedido() {
            try {
                // Envia a solicitação GET para obter informações do pedido do servidor
                const response = await fetch('http://127.0.0.1:5000/api/pedidos', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Verifica se a solicitação foi bem-sucedida
                if (response.ok) {
                    const pedido = await response.json();
                    console.log('Pedido:', pedido);
                    
                    // Extrai o valor do pedido
                    const valorPedido = pedido.valorPago;

                    // Envia uma solicitação POST para criar ou atualizar ingresso com o valor do pedido
                    await sendPostRequest(valorPedido);
                } else {
                    console.error('Erro ao obter informações do pedido:', response.statusText);
                }
            } catch (error) {
                console.error('Erro ao enviar solicitação:', error);
            }
        }

        // Função para enviar automaticamente um POST com o valor do pedido
        async function sendPostRequest(valorPedido) {
            try {
                // Dados que serão enviados no corpo da solicitação POST
                const data = {
                    ingresso_disponivel: "disponível", // Exemplo de valor para ingresso_disponivel
                    preco: valorPedido // Valor do pedido
                };

                // Envia a solicitação POST para o servidor
                const response = await fetch('http:127.0.0.1:5000/api/ingressos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                // Verifica se a solicitação foi bem-sucedida
                if (response.ok) {
                    const result = await response.json();
                    console.log('Ingresso criado:', result);
                } else {
                    console.error('Erro ao criar ingresso:', response.statusText);
                }
            } catch (error) {
                console.error('Erro ao enviar solicitação:', error);
            }
        }

        // Chama a função fetchPedido quando a página é carregada
        window.onload = fetchPedido;


    document.addEventListener('DOMContentLoaded', (event) => {
            const purchaseDateTime = localStorage.getItem('purchaseDateTime');
            if (purchaseDateTime) {
                document.getElementById('purchaseDateTime').innerText = `Purchase Date and Time: ${new Date(purchaseDateTime).toLocaleString()}`;
            } else {
                document.getElementById('purchaseDateTime').innerText = 'No purchase data found.';
            }
        });
</script>
</body>

</html>